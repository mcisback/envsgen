# TODO: caddyfile generator
[caddy.caddyfile."deploy.mywebsite.com"]
reverse_proxy = "${shared.docker.prod.gateway.hostname}:9000"

[caddy.caddyfile."sub.mywebsite.com"]
reverse_proxy = "mywebsite:5678"

[caddy.caddyfile."myapp.com"]
# Redirect non-www to www
redir = "https://www.myapp.com{uri}"

# FIX: caddy supports multiple keys while TOML has only unique keys
[caddy.caddyfile."www.myapp.com"]
reverse_proxy = "myapp:8081"
file_server = ""
"@static" = { path = [ "*.css", "*.js", "*.png", "*.jpg", "*.svg", "*.webp", "*.ico" ] }

[caddy.caddyfile."www.myapp.com".header]
"Strict-Transport-Security" = '"max-age=31536000; includeSubDomains; preload"'
"X-Frame-Options" = '"DENY"'
"X-Content-Type-Options" = '"nosniff"'
"X-XSS-Protection" = '"1; mode=block"'
"Referrer-Policy" = '"no-referrer-when-downgrade"'
"cache-control" = '"public, max-age=3600"'

[caddy.caddyfile."www.myapp.com"."reverse_proxy /api/*"]

lb_policy = "round_robin"



health_uri = "\"/health\""
health_interval = "15s"

# NOTE: This will print this, so you can have same keys multiple values for caddyfiles
# to http://backend1:8080
# to http://backend2:8081
# to http://backend2:8082
[caddy.caddyfile."www.myapp.com"."reverse_proxy /api/*".to]
_ = [
    "http://backend1:8080",
    "http://backend2:8081",
    "http://backend3:8082",
]

[caddy.caddyfile."www.myapp.com"."reverse_proxy /api/*"."transport http"]
read_timeout = "30s"
write_timeout = "30s"
dial_timeout = "10s"
tls_insecure_skip_verify = ""